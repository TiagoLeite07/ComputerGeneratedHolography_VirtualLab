<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Computer Generated Holography Virtual Lab</title>
    <link rel="stylesheet" href="css/base.css" />
</head>
<body>
    <div id="container"></div>

    <script src="js/three.min.js"></script>
    <script src="js/Detector.js"></script>
    <script src="js/controls/OrbitControls.js"></script>
    <script src="js/stats.min.js"></script>
    <script src="js/dat.gui.min.js"></script>
    <script>
        if ( ! Detector.webgl ) Detector.addGetWebGLMessage();

        var scene, camera, controls, renderer;
        var container, stats;
        var gui;

        var raycaster;
        var mouse = new THREE.Vector2(), INTERSECTED, SELECTED;

        var objects = [];

        init();

        animate();

        function init() {
            container = document.getElementById('container');

            //SCENE
            scene = new THREE.Scene();

            //RENDERER
            renderer = new THREE.WebGLRenderer({antialias: true, alpha: false});
            renderer.setClearColor(0x777777);
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.autoClear = true;

            container.appendChild(renderer.domElement);

            //CAMERA
            var aspect = window.innerWidth / window.innerHeight;

            camera = new THREE.PerspectiveCamera(45, aspect, 0.1, 10000);
            camera.position.set(0, 0, 10);
            scene.add(camera);

            //CONTROLS
            controls = new THREE.OrbitControls( camera, renderer.domElement );
            controls.target = new THREE.Vector3(3,0,0);

            //LIGHTS
            var amblight = new THREE.AmbientLight( 0x505050 );
            var light = new THREE.PointLight( 0xffffff, 1);
            light.position.set( 10, 10, 10 )
            scene.add( amblight );
            scene.add( light );

            //GEOMETRY
            var cubegeometry = new THREE.BoxGeometry(1, 1, 1)
            var cubematerial = new THREE.MeshPhongMaterial({ color: 0x00ff00 });
            var cube = new THREE.Mesh(cubegeometry, cubematerial);
            cube.scale.set(3,3,3)

            var spheregeometry = new THREE.SphereGeometry(1, 32, 32)
            var spherematerial = new THREE.MeshPhongMaterial({ color: 0x00ff00 });
            var sphere = new THREE.Mesh(spheregeometry, spherematerial);
            sphere.position.set(5,0,0)

            var planegeometry = new THREE.PlaneGeometry( 50, 50);
            var planematerial = new THREE.MeshPhongMaterial( {color: 0xffff00, side: THREE.DoubleSide} );
            var floor = new THREE.Mesh( planegeometry, planematerial );
            floor.position.y = -1.5
            floor.rotation.x = Math.PI / 2;

            scene.add(floor);
            scene.add(cube);
            scene.add(sphere);

            objects.push(cube);
            objects.push(sphere);

            //RAYCASTING
            raycaster = new THREE.Raycaster();

            //FPS COUNTER
            stats = new Stats();
            stats.domElement.style.position = 'absolute';
            stats.domElement.style.top = '0px';
            container.appendChild( stats.domElement );

            //GUI
            setGUI();

            //CALLBACKS
            window.addEventListener( 'resize', onWindowResize, false );
            window.addEventListener( 'mousemove', onDocumentMouseMove, false );
            window.addEventListener( 'mousedown', onDocumentMouseDown, false );
        }

        function setGUI()
        {
            gui = new dat.GUI();

            var parameters =
            {
                a: 200, // numeric
                b: 200, // numeric slider
                c: "Hello, GUI!", // string
                d: false, // boolean (checkbox)
                e: "#ff8800", // color (hex)
                f: function() { alert("Hello!") },
                g: function() { alert( parameters.c ) },
                v : 0,    // dummy value, only type is important
                w: "...", // dummy value, only type is important
                x: 0, y: 0, z: 0
            };
            // gui.add( parameters )
            gui.add( parameters, 'a' ).name('Number');
            gui.add( parameters, 'b' ).min(128).max(256).step(16).name('Slider');
            gui.add( parameters, 'c' ).name('String');
            gui.add( parameters, 'd' ).name('Boolean');

            gui.addColor( parameters, 'e' ).name('Color');

            var numberList = [1, 2, 3];
            gui.add( parameters, 'v', numberList ).name('List');

            var stringList = ["One", "Two", "Three"];
            gui.add( parameters, 'w', stringList ).name('List');

            gui.add( parameters, 'f' ).name('Say "Hello!"');
            gui.add( parameters, 'g' ).name("Alert Message");

            var folder1 = gui.addFolder('Coordinates');
            folder1.add( parameters, 'x' );
            folder1.add( parameters, 'y' );
            folder1.close();
            gui.open();
        }

        function onWindowResize()
        {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();

            renderer.setSize( window.innerWidth, window.innerHeight );
        }

        function onDocumentMouseDown( event )
        {
            event.preventDefault();

            camera.updateMatrixWorld();

            raycaster.setFromCamera( mouse, camera );

            var intersects = raycaster.intersectObjects( objects );

            if ( intersects.length > 0 ) {

                SELECTED = intersects[ 0 ].object;

                controls.target = SELECTED.position;

            }
        }

        function onDocumentMouseMove( event )
        {
            event.preventDefault();

            mouse.x = ( event.clientX / window.innerWidth ) * 2 - 1;
            mouse.y = - ( event.clientY / window.innerHeight ) * 2 + 1;
        }

        function animate()
        {
            requestAnimationFrame( animate );
            render();
            update();
        }

        function render()
        {
            camera.updateMatrixWorld();

            raycaster.setFromCamera( mouse, camera );

            var intersects = raycaster.intersectObjects( objects );

            if ( intersects.length > 0 ) {

                if ( INTERSECTED != intersects[ 0 ].object ) {

                    if ( INTERSECTED ) INTERSECTED.material.emissive.setHex( INTERSECTED.currentHex );

                    INTERSECTED = intersects[ 0 ].object;
                    //alert('x-'+INTERSECTED.position.x+' y-'+INTERSECTED.position.y+' z-'+INTERSECTED.position.z);
                    INTERSECTED.currentHex = INTERSECTED.material.emissive.getHex();
                    INTERSECTED.material.emissive.setHex( 0xff0000 );

                }

                container.style.cursor = 'pointer';

            } else {

                if ( INTERSECTED ) INTERSECTED.material.emissive.setHex( INTERSECTED.currentHex );

                INTERSECTED = null;

                container.style.cursor = 'auto';

            }
            renderer.render(scene, camera);
        }

        function update()
        {
            controls.update();
            stats.update();
        }
    </script>
</body>
</html>